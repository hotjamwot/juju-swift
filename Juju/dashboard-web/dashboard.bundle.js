(()=>{var $e=Object.defineProperty;var $=(n,e)=>()=>(n&&(e=n(n=0)),e);var ae=(n,e)=>{for(var t in e)$e(n,t,{get:e[t],enumerable:!0})};var q,j,F,ne,oe=$(()=>{q=["#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F","#EDC948","#B07AA1","#FF9DA7","#9C755F","#BAB0AC","#E494A6","#F1A861","#86BCB6","#A8A07D","#B881A3"],j={grid:{display:!0,color:"rgba(224, 224, 224, 0.1)"},ticks:{color:"#E0E0E0",font:{size:11},padding:5}},F={display:!0,position:"top",labels:{color:"#E0E0E0",font:{size:12},padding:15}},ne={callbacks:{label:function(n){let e=n.dataset,t=n.raw;return`${e.label}: ${t.toFixed(1)} hours`}}}});async function xe(){let n=Date.now();if(!P||n-re>je)try{P=await window.api.loadProjects(),re=n}catch(e){console.warn("Error loading projects:",e),P=[]}return P}async function Ie(n,e){let a=(await xe()).find(r=>r.name===n);return a&&a.color?a.color:q[e%q.length]}async function K(n){let e=[];for(let t=0;t<n.length;t++)e.push(await Ie(n[t],t));return e}async function se(n,e,t,a,r=null){let o=document.getElementById(n);if(!o)return console.error(`Canvas element with ID ${n} not found.`),null;if(typeof Chart>"u")return console.error("Chart.js is not loaded. Cannot create chart."),null;if(!e.length||!t.length||t.every(s=>!s.data.length)){let s=o.getContext("2d");return s.save(),s.textAlign="center",s.textBaseline="middle",s.fillStyle="#888888",s.font="14px Poppins",s.fillText("No data available for this period",o.width/2,o.height/2),s.restore(),null}let i=o.getContext("2d"),d=t.filter(s=>s.data.some(c=>c>0)),y=d.map(s=>s.label),p=await K(y);return d.forEach((s,c)=>{s.backgroundColor=p[c]}),new Chart(i,{type:"bar",data:{labels:e,datasets:d},options:{indexAxis:"x",responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:0,bottom:0,left:0,right:0}},scales:{x:{stacked:!0,...j,ticks:{...j.ticks,callback:function(s,c){if(!e||c>=e.length)return"";let m=e[c];if(r&&r[m])return r[m];if(r&&m&&m.includes("-"))try{let C=new Date(m+"T00:00:00");return!isNaN(C.getTime())&&C.getDate()!==1?C.toLocaleDateString("en-US",{month:"numeric",day:"numeric"}):""}catch{return m}return m}}},y:{stacked:!0,...j,title:{display:!0,text:a,color:"#E0E0E0"}}},plugins:{legend:F,tooltip:ne}}})}function N(n,e,t,a=3){let r=document.getElementById(n);if(!r)return console.error(`Canvas element with ID ${n} not found.`),null;if(typeof Chart>"u")return console.error("Chart.js is not loaded."),null;let o=r.getContext("2d");if(!e||!t||e.length!==4||t.length!==4)return console.warn(`[Charts] Invalid data for multi-bar comparison chart ${n}. Expected 4 labels and 4 values.`),o.save(),o.textAlign="center",o.textBaseline="middle",o.fillStyle="#888888",o.font="12px Poppins",o.fillText("Invalid data",r.width/2,r.height/2),o.restore(),null;let i="rgba(78, 121, 167, 0.4)",d="#F28E2B",y=t.map((s,c)=>c===a?d:i),p=t.map((s,c)=>c===a?d:"#4E79A7");return new Chart(o,{type:"bar",data:{labels:e,datasets:[{label:"Hours",data:t,backgroundColor:y,borderColor:p,borderWidth:1,barPercentage:1,categoryPercentage:.9}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:2,bottom:2,left:20,right:15}},scales:{x:{beginAtZero:!0,position:"top",grid:{display:!1,drawBorder:!1},ticks:{color:"#888888",font:{size:10},maxTicksLimit:4,padding:2,callback:s=>s.toFixed(1)+"h"}},y:{grid:{display:!1,drawBorder:!1},ticks:{color:"#CCCCCC",font:{size:11},padding:4,maxRotation:0,minRotation:0,autoSkip:!1,callback:function(s,c){return this.getLabelForValue(s).replace(/(Sun|Mon|Tue|Wed|Thu|Fri|Sat)day/,"$1").replace(" Weeks Ago","w ago").replace(" Months Ago","m ago")}}}},plugins:{legend:{display:!1},tooltip:{enabled:!0,callbacks:{title:function(s){return s[0].label},label:function(s){return`Hours: ${s.parsed.x.toFixed(1)}`}}}}}})}async function le(n,e,t){let a=document.getElementById(n);if(!a)return console.error(`Canvas element with ID ${n} not found.`),null;if(typeof Chart>"u")return console.error("Chart.js is not loaded."),null;let r=a.getContext("2d"),o=.01,i=[],d=[];if(e.forEach((p,s)=>{t[s]>=o&&(i.push(p),d.push(t[s]))}),i.length===0)return console.log(`[Charts] No significant data for pie chart ${n}.`),null;let y=await K(i);return new Chart(r,{type:"pie",data:{labels:i,datasets:[{data:d,backgroundColor:y,borderColor:"#1E1E1E",borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{...F,position:"top"},tooltip:{callbacks:{label:function(p){let s=p.label||"",c=p.parsed||0,m=p.chart.data.datasets[0].data.reduce((w,D)=>w+D,0),C=m>0?(c/m*100).toFixed(1):0;return`${s}: ${c.toFixed(1)} hours (${C}%)`}}}}}})}async function ie(n,e){let t=document.getElementById(n).getContext("2d"),a=await K(e.datasets.map(o=>o.label)),r=e.datasets.map((o,i)=>({...o,backgroundColor:a[i],borderColor:a[i],fill:!0,tension:.4,borderWidth:1,pointRadius:0,pointHoverRadius:0}));return new Chart(t,{type:"line",data:{labels:e.labels,datasets:r},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},scales:{y:{stacked:!0,...j,title:{display:!0,text:"Cumulative Hours",color:"#E0E0E0"}},x:j},plugins:{title:{display:!0,text:"Cumulative Hours by Project",color:"#E0E0E0",padding:{bottom:15}},legend:{...F,position:"bottom"},tooltip:{callbacks:{label:function(o){let i=o.dataset.label||"";return i&&(i+=": "),o.parsed.y!==null&&(i+=o.parsed.y.toFixed(1)+" total hours"),i}}}}}})}var P,re,je,ce=$(()=>{oe();P=null,re=0,je=5e3});function de(n){let e=parseInt(String(n),10);if(n==null||isNaN(e)||e<0)return"?";let t=Math.floor(e/60),a=e%60;return`${t}h ${a}m`}function ue(n){n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),n.setUTCDate(n.getUTCDate()+4-(n.getUTCDay()||7));var e=new Date(Date.UTC(n.getUTCFullYear(),0,1)),t=Math.ceil(((n.getTime()-e.getTime())/864e5+1)/7);return t}var z=$(()=>{});function pe(n){if(!n||n.length===0)return console.log("[Charts] No sessions for daily breakdown chart."),{labels:[],monthLabels:{},datasets:[]};let e={},t=new Set,a=null,r=null;if(n.forEach(c=>{let m=c.date;try{let C=new Date(m+"T00:00:00");if(!m||isNaN(C.getTime()))return;(a===null||C<a)&&(a=C),(r===null||C>r)&&(r=C);let w=c.project||"Unassigned";t.add(w);let D=(c.duration_minutes||0)/60;e[m]||(e[m]={}),e[m][w]=(e[m][w]||0)+D}catch{}}),a===null||r===null)return{labels:[],monthLabels:{},datasets:[]};let o=[],i={},d=new Date(a);for(new Date().setHours(0,0,0,0);d<=r;){let c=d.getFullYear(),m=(d.getMonth()+1).toString().padStart(2,"0"),C=d.getDate().toString().padStart(2,"0"),w=`${c}-${m}-${C}`;o.push(w),d.getDate()===1&&(i[w]=d.toLocaleDateString("en-GB",{month:"short"})),d.setDate(d.getDate()+1)}let s=Array.from(t).sort().map(c=>({label:c,data:o.map(m=>e[m]?.[c]||0),backgroundColor:"#000000"}));return{labels:o,monthLabels:i,datasets:s}}function me(n){if(!n||n.length===0)return console.log("[Charts] No sessions for weekly chart."),{labels:[],datasets:[]};let e={},t=new Set,a=new Set;n.forEach(d=>{try{let y=new Date(d.date+"T00:00:00");if(isNaN(y.getTime()))return;let p=y.getFullYear(),s=ue(y),c=`${p}-W${s.toString().padStart(2,"0")}`;a.add(c);let m=d.project||"Unassigned";t.add(m);let C=(d.duration_minutes||0)/60;e[c]||(e[c]={}),e[c][m]=(e[c][m]||0)+C}catch{}});let r=Array.from(a).sort(),i=Array.from(t).sort().map(d=>{let y=0,p=r.map(s=>(y+=e[s]?.[d]||0,y));return{label:d,data:p,backgroundColor:"#000000",borderWidth:2,fill:!0}});return{labels:r,datasets:i.reverse()}}function fe(n){let e={};n.forEach(r=>{let o=r.project||"Unassigned";e[o]=(e[o]||0)+(r.duration_minutes||0)});let t=Object.keys(e).sort(),a=t.map(r=>e[r]/60);return{labels:t,data:a}}var he=$(()=>{z()});var ye={};ae(ye,{destroyCharts:()=>ge,updateCharts:()=>Te});function Le(){if(typeof Chart>"u")throw new Error("Chart.js is not loaded. Cannot create charts.")}function ge(){I&&I.destroy(),L&&L.destroy(),T&&T.destroy(),H&&H.destroy(),M&&M.destroy(),U&&U.destroy(),I=L=T=null,H=M=U=null,console.log("[Charts] Destroyed existing chart instances.")}async function Te(n,e,t){try{Le();let a=document.getElementById("chart-range-title");a&&(a.textContent=`Showing data for: ${t}`),ge();try{console.log("[Charts] Fetching comparison stats...");let r=await window.api.getComparisonStats();if(r){let o=r.day;if(o&&o.past&&o.current){let y=[...o.past.map(m=>m.label),o.current.label],p=[...o.past.map(m=>m.value),o.current.value];H=N("day-comparison-bar-chart",y,p,3);let s=document.getElementById("day-comparison-details");s&&(s.textContent=`Today: ${o.current.value.toFixed(1)}h (${o.current.range})`);let c=document.getElementById("day-comparison-title");if(c){let m=o.past.length>0?o.past[o.past.length-1].label:"Previous Day";c.textContent=`Compared to Previous ${m.split(" ")[1]}s`}}else console.warn("Day comparison data missing or invalid:",o);let i=r.week;if(i&&i.past&&i.current){let y=[...i.past.map(c=>c.label),i.current.label],p=[...i.past.map(c=>c.value),i.current.value];M=N("week-comparison-bar-chart",y,p,3);let s=document.getElementById("week-comparison-details");s&&(s.textContent=`This Week: ${i.current.value.toFixed(1)}h (${i.current.range})`)}else console.warn("Week comparison data missing or invalid:",i);let d=r.month;if(d&&d.past&&d.current){let y=[...d.past.map(c=>c.label),d.current.label],p=[...d.past.map(c=>c.value),d.current.value];U=N("month-comparison-bar-chart",y,p,3);let s=document.getElementById("month-comparison-details");s&&(s.textContent=`This Month: ${d.current.value.toFixed(1)}h (${d.current.range})`)}else console.warn("Month comparison data missing or invalid:",d)}else console.warn("Comparison stats data is missing.")}catch(r){console.error("[Charts] Error with comparison stats:",r),["day","week","month"].forEach(o=>{let i=document.getElementById(`${o}-comparison-details`);i&&(i.textContent="Error loading stats")})}if(!n||n.length===0)return console.log("[Charts] No filtered session data for main charts."),{yearlyChart:null,weeklyChart:null,pieChart:null};console.log(`[Charts] Updating main charts for "${t}" with ${n.length} sessions.`);try{let r=pe(n);I=await se("yearly-chart",r.labels,r.datasets,"Hours",r.monthLabels);let o=me(n);L=await ie("weekly-chart",o);let i=fe(n);return T=await le("pie-chart",i.labels,i.data),{yearlyChart:I,weeklyChart:L,pieChart:T}}catch(r){return console.error("[Charts] Error creating charts:",r),{yearlyChart:null,weeklyChart:null,pieChart:null}}}catch(a){return console.error("[Charts] Error updating charts:",a),{yearlyChart:null,weeklyChart:null,pieChart:null}}}var I,L,T,H,M,U,be=$(()=>{ce();he();I=null,L=null,T=null,H=null,M=null,U=null});var Ce={};ae(Ce,{setupTabs:()=>Se,updateSessionsTable:()=>Be});function Se(){document.querySelectorAll(".tab").forEach(n=>{n.addEventListener("click",()=>{document.querySelectorAll(".tab").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(a=>a.classList.remove("active")),n.classList.add("active");let e=n.dataset.tab,t=document.getElementById(e);t?t.classList.add("active"):console.error(`Tab content not found for ID: ${e}`)})}),console.log("[UI] Tabs setup complete.")}function Be(n,e){if(!_){console.error("[UI] Cannot update sessions table: recentSessionsBody element not found.");return}if(_.innerHTML="",!n||n.length===0){_.innerHTML=`
            <tr><td colspan="6" class="no-data">No sessions match the current filter or page.</td></tr>`,console.log("[UI] Sessions table updated with no data message.");return}n.forEach(t=>{let a=document.createElement("tr");a.setAttribute("data-session-key",`${t.id}-${t.date}-${t.start_time}`);let r="Invalid Date";try{let p=new Date(t.date+"T00:00:00");if(!isNaN(p.getTime())){let s=p.getFullYear(),c=(p.getMonth()+1).toString().padStart(2,"0"),m=p.getDate().toString().padStart(2,"0");r=`${s}-${c}-${m}`}}catch{}let o=typeof t.start_time=="string"?t.start_time.slice(0,5):"??:??",i=typeof t.end_time=="string"?t.end_time.slice(0,5):"??:??",d=t.project||"N/A",y=t.notes||"";a.innerHTML=`
            <td class="editable" data-field="date" data-id="${t.id}">${r}</td>
            <td class="editable" data-field="project" data-id="${t.id}">${d}</td>
            <td data-field="duration_minutes" data-id="${t.id}">${de(t.duration_minutes)}</td>
            <td class="editable" data-field="start_time" data-id="${t.id}">${o}</td>
            <td class="editable" data-field="end_time" data-id="${t.id}">${i}</td>
            <td class="editable" data-field="notes" data-id="${t.id}">${y}</td>
            <td class="actions">
                <button class="btn btn-delete" data-id="${t.id}" title="Delete Session">\xD7</button>
            </td>
        `,_.appendChild(a)}),Ae(e),Ne(e),console.log("[UI] Sessions table updated.")}function Ae(n){document.querySelectorAll("#recent-sessions-body td.editable").forEach(e=>{let t=Fe.bind(e,n);e.removeEventListener("click",e._boundHandleCellClick),e.addEventListener("click",t),e._boundHandleCellClick=t})}async function Fe(n){if(this.querySelector("input, textarea, select"))return;let e=this.textContent,t=this.dataset.field;this.setAttribute("data-original-value",e);let a;if(t==="project"){a=document.createElement("select"),a.classList.add("inline-edit-input"),a.style.width="100%",a.style.height="100%";let i=document.createElement("option");i.text="Loading...",a.add(i);try{let d=await window.api.getProjectNames();a.innerHTML="";let y=document.createElement("option");y.value="",y.text="-- Select Project --",a.add(y),d.forEach(p=>{let s=document.createElement("option");s.value=p,s.text=p,p===e&&(s.selected=!0),a.add(s)})}catch(d){console.error("Failed to load project names:",d)}}else t==="start_time"||t==="end_time"?(a=document.createElement("input"),a.type="time",a.value=/^\d{2}:\d{2}$/.test(e)?e:"00:00"):t==="date"?(a=document.createElement("input"),a.type="date",a.value=/^\d{4}-\d{2}-\d{2}$/.test(e)?e:new Date().toISOString().slice(0,10)):t==="notes"?(a=document.createElement("textarea"),a.value=e,a.rows=2):(a=document.createElement("input"),a.type="text",a.value=e);a.classList.add("inline-edit-input"),this.innerHTML="",this.appendChild(a),a.focus(),a.type==="text"&&a.select();let r=we.bind(a,n),o=Pe.bind(a,n);a.addEventListener("blur",r),a.addEventListener("keydown",o),a._boundBlurHandler=r,a._boundKeydownHandler=o}async function Pe(n,e){if(e.key==="Enter"){if(this.tagName==="TEXTAREA"&&e.shiftKey)return;e.preventDefault(),console.log("[UI] Enter key pressed, saving..."),await we.call(this,n)}else if(e.key==="Escape"){console.log("[UI] Escape key pressed, cancelling edit.");let t=this.parentElement,a=t.getAttribute("data-original-value");this.removeEventListener("blur",this._boundBlurHandler),this.removeEventListener("keydown",this._boundKeydownHandler),t.textContent=a,t.removeAttribute("data-original-value")}}async function we(n){let e=this.parentElement;if(!e||!e.dataset){console.warn("[UI] handleCellUpdate called on detached or invalid element."),this.removeEventListener("blur",this._boundBlurHandler),this.removeEventListener("keydown",this._boundKeydownHandler);try{this.remove()}catch{}return}let t=this.value.trim(),a=e.getAttribute("data-original-value"),r=e.dataset.id,o=e.dataset.field;if(this.removeEventListener("blur",this._boundBlurHandler),this.removeEventListener("keydown",this._boundKeydownHandler),t===a){e.textContent=a,console.log("[UI] Value unchanged, edit cancelled."),e.removeAttribute("data-original-value");return}console.log(`[UI] Attempting update: ID=${r}, Field=${o}, NewValue=${t}`),e.textContent="Saving...";try{await window.api.updateSession(r,o,t),console.log(`[UI] Update successful for ID=${r}, Field=${o}. Refreshing data.`),typeof n=="function"?n():console.warn("[UI] refreshDashboardDataCallback is not a function!")}catch(i){console.error(`[UI] Error updating session (ID=${r}, Field=${o}):`,i),alert(`Failed to update session: ${i.message||"Unknown error"}`),e.textContent=a}finally{e.removeAttribute("data-original-value")}}function Ne(n){document.querySelectorAll("#recent-sessions-body .btn-delete").forEach(e=>{e.addEventListener("click",async t=>{let a=t.target.dataset.id;if(a&&confirm("Are you sure you want to delete this session? This cannot be undone."))try{await window.api.deleteSession(a),console.log(`[UI] Session deleted successfully: ${a}`),typeof n=="function"&&n()}catch(r){console.error("[UI] Error deleting session:",r),alert("Failed to delete session. Please try again.")}})})}var _,Ee=$(()=>{z();_=document.getElementById("recent-sessions-body")});document.addEventListener("DOMContentLoaded",async()=>{try{let S=function(l,u=null,f=null){let h=new Date;h.setHours(0,0,0,0);let b=new Date(h),g=new Date(h);g.setHours(23,59,59,999);let E="";switch(l){case"7d":b.setDate(h.getDate()-6),E="Last 7 Days";break;case"1m":b=new Date(h.getFullYear(),h.getMonth()-1,h.getDate()),E="Last Month";break;case"3m":b=new Date(h.getFullYear(),h.getMonth()-3,h.getDate()),E="Last Quarter";break;case"1y":b=new Date(h.getFullYear(),0,1),E="This Year";break;case"all":b=null,g=null,E="All Time";break;case"custom":try{if(b=u?new Date(u+"T00:00:00"):null,g=f?new Date(f+"T23:59:59.999"):null,b&&g&&b>g)return alert("Start date cannot be after end date."),{startDate:null,endDate:null,rangeTitle:"Invalid Range"};E=`Custom (${u||"..."} - ${f||"..."})`}catch(v){return console.error("Error parsing custom dates:",v),alert("Invalid custom date format."),{startDate:null,endDate:null,rangeTitle:"Invalid Range"}}break;default:b=new Date(h.getFullYear(),0,1),E="This Year"}return b&&!(b instanceof Date&&!isNaN(b))&&(b=null),g&&!(g instanceof Date&&!isNaN(g))&&(g=null),{startDate:b,endDate:g,rangeTitle:E}},O=function(l,u){return p?l===null&&u===null?[...p]:p.filter(f=>{try{let h=new Date(f.date+"T00:00:00");if(isNaN(h.getTime()))return!1;let b=l===null||h>=l,g=u===null||h<=u;return b&&g}catch(h){return console.warn("Error parsing session date during filter:",f.date,h),!1}}):[]},Z=function(){if(!k)return;let l=[...new Set(p.map(u=>u.project||"N/A"))].sort();k.innerHTML='<option value="All">All Projects</option>',l.forEach(u=>{if(u){let f=document.createElement("option");f.value=u,f.textContent=u,k.appendChild(f)}}),k.value=D,console.log("[Dashboard] Project filter populated.")},V=function(){let l=p;D!=="All"&&(l=p.filter(E=>(E.project||"N/A")===D)),l.sort((E,v)=>{let ee=new Date(`${E.date||""}T${E.start_time||""}`).getTime(),te=new Date(`${v.date||""}T${v.start_time||""}`).getTime(),ke=isNaN(ee)?-1/0:ee;return(isNaN(te)?-1/0:te)-ke});let u=l.length,f=Math.max(1,Math.ceil(u/C));w>f&&(w=f),w<1&&(w=1);let h=(w-1)*C,b=h+C;return{visibleSessions:l.slice(h,b),currentPage:w,totalPages:f}},x=function(){let{visibleSessions:l,currentPage:u,totalPages:f}=V();w=u,y(l,B),Q&&(Q.textContent=`Page ${w} of ${f}`),W&&(W.disabled=w<=1),R&&(R.disabled=w>=f),console.log(`[Dashboard] Session display refreshed. Page: ${w}/${f}, Filter: ${D}`)};var n=S,e=O,t=Z,a=V,r=x;let{updateCharts:o,destroyCharts:i}=await Promise.resolve().then(()=>(be(),ye)),{setupTabs:d,updateSessionsTable:y}=await Promise.resolve().then(()=>(Ee(),Ce)),p=[],s=[],c="1y",m="This Year",C=20,w=1,D="All",Y=document.querySelectorAll(".btn-filter"),J=document.getElementById("date-from"),G=document.getElementById("date-to"),ve=document.getElementById("apply-custom-date"),k=document.getElementById("project-filter-select"),W=document.getElementById("prev-page-btn"),R=document.getElementById("next-page-btn"),Q=document.getElementById("page-info");window.onSessionsLoaded=function(l){if(typeof l=="string")try{l=JSON.parse(l)}catch(u){console.error("Failed to parse sessions JSON",u),l=[]}p=l,B()},window.onProjectsLoaded=function(l){if(typeof l=="string")try{l=JSON.parse(l)}catch(u){console.error("Failed to parse projects JSON",u),l=[]}s=l,typeof A=="function"&&A()};async function X(l){console.log(`[Dashboard] Date filter changed to: ${l}`);let u=null,f=null;if(l==="custom"&&(u=J.value,f=G.value,!u||!f)){alert("Please select both 'From' and 'To' dates for custom range.");return}let{startDate:h,endDate:b,rangeTitle:g}=S(l,u,f);if(g==="Invalid Range")return;let E=O(h,b);console.log(`[Dashboard] Filtered sessions count for chart "${g}": ${E.length}`),c=l,m=g,Y.forEach(v=>{v.dataset.range===l?v.classList.add("active"):v.classList.remove("active")}),l==="custom"&&Y.forEach(v=>{v.closest(".date-filter-buttons")&&v.classList.remove("active")});try{await o(E,p,g)}catch(v){console.error(`[Dashboard] Error updating charts for range ${l}:`,v)}}async function B(){console.log("[Dashboard] Refreshing dashboard data...");try{k.options.length<=1&&Z(),x();let l,u;c==="custom"?{startDate:l,endDate:u}=S(c,J.value,G.value):{startDate:l,endDate:u}=S(c);let f=O(l,u);await o(f,p,m)}catch(l){console.error("[Dashboard] Error refreshing dashboard data:",l)}}async function De(){let l=document.getElementById("projects-list"),u=document.getElementById("add-project-form");if(!l||!u){console.error("Project management elements not found");return}await A(),u.addEventListener("submit",async f=>{f.preventDefault();let h=document.getElementById("new-project-name"),b=document.getElementById("new-project-color");if(!(!h||!b))try{let g=await window.api.addProject({name:h.value.trim(),color:b.value});g&&g.success&&(h.value="",b.value="#4E79A7",await A(),await B())}catch(g){console.error("Error adding project:",g),alert("Failed to add project: "+g.message)}})}async function A(){let l=document.getElementById("projects-list");if(!l){console.error("Projects list element not found");return}try{l.innerHTML="",s.forEach(u=>{let f=document.createElement("div");f.className="project-item",f.innerHTML=`
                        <div class="project-info">
                            <span class="project-name">${u.name}</span>
                            <div class="project-color">
                                <input type="color" value="${u.color||"#4E79A7"}" 
                                       data-project-id="${u.id}">
                            </div>
                        </div>
                        <div class="project-actions">
                            <button class="delete-project" data-project-id="${u.id}">Delete</button>
                        </div>
                    `;let h=f.querySelector('input[type="color"]');h&&h.addEventListener("change",async g=>{try{await window.api.updateProjectColor(u.id,g.target.value),window.api.loadProjects(),window.api.loadSessions()}catch(E){console.error("Error updating project color:",E),alert("Failed to update color: "+E.message)}});let b=f.querySelector(".delete-project");b&&b.addEventListener("click",async()=>{if(confirm(`Are you sure you want to delete ${u.name}?`))try{await window.api.deleteProject(u.id),window.api.loadProjects(),window.api.loadSessions()}catch(g){console.error("Error deleting project:",g),alert("Failed to delete project: "+g.message)}}),l.appendChild(f)})}catch(u){console.error("Error loading projects:",u),l.innerHTML='<div class="error">Failed to load projects</div>'}}Y.forEach(l=>{l.closest(".date-filter-buttons")&&l.addEventListener("click",()=>X(l.dataset.range))}),ve.addEventListener("click",()=>X("custom")),k?.addEventListener("change",l=>{D=l.target.value,w=1,x()}),W?.addEventListener("click",()=>{w>1&&(w--,x())}),R?.addEventListener("click",()=>{let{totalPages:l}=V();w<l&&(w++,x())}),d(),console.log("Calling window.api.loadProjects and loadSessions"),window.api.loadProjects(),window.api.loadSessions(),await De(),await B()}catch(o){console.error("[Dashboard] Error initializing dashboard:",o);let i=document.getElementById("charts");i&&(i.innerHTML=`<div class="error-message">Failed to initialize dashboard. Please check console for details. Error: ${o.message}</div>`)}});})();
