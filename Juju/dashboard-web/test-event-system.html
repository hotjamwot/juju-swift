<!DOCTYPE html>
<html>
<head>
    <title>Event System Test</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Event System Test</h1>
        
        <div class="test-section">
            <h3>Notification Tests</h3>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testNotification('success', 'Success Test', 'This is a success notification')">Success</button>
                <button class="btn btn-danger" onclick="testNotification('error', 'Error Test', 'This is an error notification')">Error</button>
                <button class="btn btn-secondary" onclick="testNotification('warning', 'Warning Test', 'This is a warning notification')">Warning</button>
                <button class="btn btn-primary" onclick="testNotification('info', 'Info Test', 'This is an info notification')">Info</button>
            </div>
        </div>

        <div class="test-section">
            <h3>Modal Tests</h3>
            <div class="test-buttons">
                <button class="btn btn-danger" onclick="testModal('Delete Test', 'Are you sure you want to delete this item?')">Delete Confirmation</button>
                <button class="btn btn-primary" onclick="testModal('Save Test', 'Do you want to save your changes?')">Save Confirmation</button>
            </div>
        </div>

        <div class="test-section">
            <h3>Event System Tests</h3>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testEvents()">Test Events</button>
                <button class="btn btn-secondary" onclick="clearEvents()">Clear Events</button>
            </div>
            <div id="event-log" style="margin-top: 10px; padding: 10px; background: var(--background-light); border-radius: 8px; max-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Notification System -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Confirm Action</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="modal-message">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">Cancel</button>
                <button class="btn btn-danger" id="modal-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <script type="module">
        import eventSystem from './src/renderer/dashboard/event-system.js';

        // Make eventSystem available globally for testing
        window.eventSystem = eventSystem;

        // Test functions
        window.testNotification = function(type, title, message) {
            eventSystem.showNotification(type, title, message);
        };

        window.testModal = async function(title, message) {
            const result = await eventSystem.showConfirmation(title, message);
            console.log('Modal result:', result);
            eventSystem.showNotification(result ? 'success' : 'info', 'Modal Result', result ? 'Confirmed' : 'Cancelled');
        };

        window.testEvents = function() {
            // Test event emission
            eventSystem.emit('testEvent', { message: 'Test event fired!', timestamp: new Date().toISOString() });
        };

        window.clearEvents = function() {
            document.getElementById('event-log').innerHTML = '';
        };

        // Set up event listener for testing
        eventSystem.on('testEvent', (data) => {
            const log = document.getElementById('event-log');
            const entry = document.createElement('div');
            entry.textContent = `${data.timestamp}: ${data.message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        });

        // Test deletion utilities
        window.testDeleteSession = async function() {
            const result = await eventSystem.deleteWithConfirmation(
                'Session',
                '123',
                'Test Session',
                async (id) => {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return { success: true };
                }
            );
            console.log('Delete session result:', result);
        };

        window.testDeleteProject = async function() {
            const result = await eventSystem.deleteWithConfirmation(
                'Project',
                '456',
                'Test Project',
                async (id) => {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return { success: true };
                }
            );
            console.log('Delete project result:', result);
        };

        console.log('Event system test page loaded');
    </script>
</body>
</html> 